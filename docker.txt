proxy=192.168.3.102
alias up='sudo apt -yqq update && sudo apt -y upgrade && sudo apt -y dist-upgrade && sudo apt -y autoremove --purge && sudo apt autoclean && sudo apt clean'
up

sudo apt -y install linux-image-extra-virtual apt-transport-https ca-certificates curl software-properties-common
curl -fsSL "https://download.docker.com/linux/$(. /etc/os-release; echo "$ID")/gpg" | sudo apt-key add -
echo -e "deb [arch=$(dpkg --print-architecture)] http://download.docker.com/linux/$(. /etc/os-release; echo "$ID") $(lsb_release -cs) stable edge" | sudo tee -a /etc/apt/sources.list.d/docker.list

up ; sudo apt -yqq install docker-ce

sudo mkdir -p /etc/docker && sudo vi $_/daemon.json
```json
{
    "max-concurrent-downloads": 20,
    "max-concurrent-uploads": 20,
    "log-level": "warn",
    "log-opts": {
        "max-size": "2m",
        "max-file": "5"
    }
}
```

# 安装 docker-compose
pip3 install docker-compose
mkdir -p ~/.local/share/bash-completion/completions
curl -L https://raw.githubusercontent.com/docker/compose/master/contrib/completion/bash/docker-compose > ~/.local/share/bash-completion/completions/docker-compose 

# 代理
sudo mkdir -p /etc/systemd/system/docker.service.d/
echo -e "[Service]\nEnvironment=\"https_proxy=http://$proxy:8123/\" \"http_proxy=http://$proxy:8123/\"" | sudo tee /etc/systemd/system/docker.service.d/http-proxy.conf

sudo gpasswd -a ${USER} docker

# clash
cd ~/VHD/gitSou/docker-clash
sudo docker build --build-arg http_proxy="http://$proxy:8123" --build-arg https_proxy="http://$proxy:8123" -t clash .
cd ~/Documents/clash.yaml/
git pull
sudo docker rm -f clash ; sudo docker run -d --restart always --name clash -v ~/Documents/clash.yaml/clash.yaml:/root/.config/clash/config.yaml --network host clash

proxy=192.168.3.101
echo -e "[Service]\nEnvironment=\"https_proxy=http://$proxy:8123/\" \"http_proxy=http://$proxy:8123/\"" | sudo tee /etc/systemd/system/docker.service.d/http-proxy.conf
echo -e "Acquire::http::proxy \"http://$proxy:8123/\";\nAcquire::https::Proxy \"http://$proxy:8123/\";" | sudo tee /etc/apt/apt.conf

# Aria2
cd ~/VHD/gitSou/docker-aria2-with-webui
git pull
sudo docker build --build-arg http_proxy="http://$proxy:8123" --build-arg https_proxy="http://$proxy:8123" -t aria2 .
sudo docker rm -f aria2 ; sudo docker run -d --restart always --name aria2 --network host -e SECRET=333544 -v ~/Downloads:/data aria2

# darkhttpd
cd ; git clone --depth=1 https://github.com/emikulic/darkhttpd.git && cd darkhttpd
docker build --build-arg http_proxy="http://$proxy:8123" --build-arg https_proxy="http://$proxy:8123" -t darkhttpd .
.. ; rm -rf darkhttpd

# mongo
# 树莓派不支持 5.0,需要安装 4.4
docker pull mongo:4.4
docker run -d --name mongo --restart always -e MONGO_INITDB_ROOT_USERNAME=mongo -e MONGO_INITDB_ROOT_PASSWORD=mongo -v /mnt/Data/mongo:/data/db -p 27017:27017 mongo:4.4 --wiredTigerCollectionBlockCompressor zlib
docker exec -it mongo mongo --username mongo --password mongo --authenticationDatabase admin
```mongo
use my_db
# 添加用户
db.createUser({user: 'user_name',pwd: 'password',roles: [{ role: 'dbOwner', db: 'my_db' }]})
```

# 阿里云盘
docker pull messense/aliyundrive-webdav
REFRESH_TOKEN=
docker run -d --name aliyundrive-webdav --restart always -p 7777:8080 -v ~/Downloads/aliyundrive-webdav/:/etc/aliyundrive-webdav/ -e WEBDAV_AUTH_USER=admin -e WEBDAV_AUTH_PASSWORD=admin -e REFRESH_TOKEN="$REFRESH_TOKEN" messense/aliyundrive-webdav
