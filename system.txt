# 代理
proxy=192.168.3.102
export http_proxy=http://$proxy:8123/ && export https_proxy=http://$proxy:8123/ 
echo -e "proxy=http://$proxy:8123" | sudo tee -a /etc/dnf/dnf.conf

alias up='sudo dnf -y update && sudo dnf -y upgrade && sudo dnf -y autoremove && sudo dnf -q clean all'

sudo dnf autoremove -y firefox* hplip* vim* gedit* libreoffice*
sudo rm -rf /usr/lib64/firefox
sudo dnf install -y https://mirrors.rpmfusion.org/free/fedora/rpmfusion-free-release-$(rpm -E %fedora).noarch.rpm https://mirrors.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-$(rpm -E %fedora).noarch.rpm
up
sudo dnf -y install vim

# 调整系统
sudo vi /etc/systemd/system.conf
sudo vi /etc/default/grub
#GRUB_DISABLE_OS_PROBER=false

# 修复 apt 自动补全
sudo dnf -y reinstall bash-completion

# 禁用传统 SWAP
sudo vi /etc/fstab

# 启用 zRAM
echo "zram" | sudo tee /etc/modules-load.d/zram.conf
echo "options zram num_devices=1" | sudo tee /etc/modprobe.d/zram.conf
echo 'KERNEL=="zram0", ATTR{disksize}="2048M",TAG+="systemd"' | sudo tee /etc/udev/rules.d/99-zram.rules
sudo vi /etc/systemd/system/zram.service && sudo systemctl enable zram
```ini
[Unit]
Description=Swap with zram
After=multi-user.target

[Service]
Type=oneshot 
RemainAfterExit=true
ExecStartPre=/sbin/mkswap /dev/zram0
ExecStart=/sbin/swapon /dev/zram0
ExecStop=/sbin/swapoff /dev/zram0

[Install]
WantedBy=multi-user.target
```

# 系统参数
cat /proc/sys/vm/swappiness
sudo sysctl -a | grep vm.swappiness
echo "vm.swappiness = 5" | sudo tee -a /etc/sysctl.conf
sudo sysctl -a | grep net.core.somaxconn
echo "net.core.somaxconn = 4096" | sudo tee -a /etc/sysctl.conf
sudo sysctl -a | grep kernel.shmmax
echo "kernel.shmmax = 18446744073692774399" | sudo tee -a /etc/sysctl.conf
sudo sysctl -a | grep fs.inotify.max_user_watches
echo 'fs.inotify.max_user_watches = 524288' | sudo tee -a /etc/sysctl.conf
sudo sysctl -p

# 修改交换文件大小(pi)
sudo vi /etc/dphys-swapfile ; sudo systemctl restart dphys-swapfile.service
sudo reboot

# 删除快捷方式
rm -rf Desktop
cd /usr/share/applications
sudo rm -rf python3.8.desktop vim.desktop evolution-calendar.desktop ; cd

sudo vi /etc/bash.bashrc

# 挂载存储
sudo fdisk -l
echo "/dev/sda1 /mnt ntfs-3g uid=ljason,gid=ljason,silent,locale=zh_CN.utf8 0 0" | sudo tee -a /etc/fstab
sudo umount /dev/sda1 ; sudo mount /dev/sda1 /mnt
mkdir ~/VHD
sudo mount /mnt/Linux/VHD.img ~/VHD
mkdir ~/Android
sudo mount /mnt/Linux/Android.img ~/Android
echo "/mnt/Linux/VHD.img /home/ljason/VHD ext4 defaults 0 0" | sudo tee -a /etc/fstab
echo "/mnt/Linux/Android.img /home/ljason/Android ext4 defaults 0 0" | sudo tee -a /etc/fstab
cd ~/VHD/gitSou/dotfiles ; ./install.sh ; cd
rm -rf Music && ln -s /mnt/System/Music .
rm -rf Pictures && ln -s /mnt/System/Pictures .
rm -rf Videos && ln -s /mnt/System/Videos .
rm -rf Downloads && ln -s /mnt/System/Downloads .
rm -rf Documents && ln -s /mnt/System/Documents .
cp /mnt/Sync/Server/Desktop/ljason/ssh/id_ed25519 .ssh/
ln -s /mnt/VirtualBox\ VMs/Linux VirtualBox\ VMs
chmod 600 .ssh/id_ed25519

# 挂载硬盘（pi）
sudo fdisk -l
sudo umount /dev/sda1 ; sudo mount /dev/sda1 /mnt ; ls -la /mnt/
ls -l  /dev/disk/by-uuid/ | grep sdb1 | awk '{print $9}'
echo "UUID=$(ls -l  /dev/disk/by-uuid/ | grep sdb1 | awk '{print $9}') /mnt ext4 defaults 0 0" | sudo tee -a /etc/fstab ; cat /etc/fstab

# 隐藏挂载硬盘
gsettings set org.gnome.shell.extensions.dash-to-dock show-mounts false
# 隐藏桌面文件夹
echo "Public" >> ~/.hidden

# 安装字体
mkdir ~/.local/share/fonts
cp /mnt/System/Documents/Font/FiraCode/otf/FiraCode-* ~/.local/share/fonts/
cp /mnt/System/Documents/Font/source-han-serif/SuperOTC/SourceHanSerif.ttc ~/.local/share/fonts/
fc-cache -f -v

# dnf
echo -e "[code]\nname=Visual Studio Code\nbaseurl=https://packages.microsoft.com/yumrepos/vscode\nenabled=1\ngpgcheck=1\ngpgkey=https://packages.microsoft.com/keys/microsoft.asc" | sudo tee /etc/yum.repos.d/vscode.repo
sudo rpm --import https://packages.microsoft.com/keys/microsoft.asc

up ; sudo dnf install -y mpv mpv-libs ncdu google-chrome-stable screen stow ffmpeg nginx code imwheel
gnome-tweak

 gettext

# git-lfs
curl -sSf "https://packagecloud.io/install/repositories/github/git-lfs/config_file.list?os=Ubuntu&dist=$(lsb_release -cs)&source=script" | sudo tee /etc/apt/sources.list.d/git-lfs.list
wget -q https://packagecloud.io/github/git-lfs/gpgkey -O- | sudo apt-key add -
up && sudo apt -y install git-lfs

google-chrome-stable --proxy-server="socks5://$proxy:1080" &
# GNOME 扩展
google-chrome-stable https://extensions.gnome.org/extension/104/netspeed/ &

# 时间
sudo ntpdate ntp5.aliyun.com && sudo hwclock --localtime --systohc

# 添加手机到 udev
echo 'SUBSYSTEM=="usb", ATTRS{idVendor}=="18d1",ATTRS{idProduct}=="4ee7",MODE="0666"' | sudo tee /etc/udev/rules.d/50-pixel.rules
echo 'SUBSYSTEM=="usb", ATTRS{idVendor}=="18d1",ATTRS{idProduct}=="4ee0",MODE="0666"' | sudo tee /etc/udev/rules.d/51-pixel.rules
echo 'SUBSYSTEM=="usb", ATTRS{idVendor}=="18d1",ATTRS{idProduct}=="4ee7",MODE="0666"' | sudo tee /etc/udev/rules.d/50-nexus.rules
echo 'SUBSYSTEM=="usb", ATTRS{idVendor}=="18d1",ATTRS{idProduct}=="d00d",MODE="0666"' | sudo tee /etc/udev/rules.d/50-huawei.rules
echo 'SUBSYSTEM=="usb", ATTRS{idVendor}=="045e",ATTRS{idProduct}=="02fe",MODE="0666"' | sudo tee /etc/udev/rules.d/50-xbox.rules
sudo systemctl restart udev.service

# 优化系统
gsettings set org.gnome.desktop.interface show-battery-percentage true
gsettings set org.gnome.desktop.session idle-delay 3600

# Python 3.10 https://www.python.org/downloads/source/
screen -S py
version=3.10.1
fq
wget https://www.python.org/ftp/python/$version/Python-$version.tar.xz
tar Jxf Python-$version.tar.xz ; cd Python-$version/
sudo dnf install -y libsqlite3x-devel openssl-devel libffi-devel bzip2-devel zlib-devel
./configure --enable-loadable-sqlite-extensions --enable-optimizations 
make -j16 ; sudo make install -j16
python3 -V
sudo python3 -m pip install --upgrade pip
cd .. ; sudo rm -rf Python-$version*
exit
# bilili
pip3 install bilili youtube-dl

# 模糊搜索
git clone --depth=1 https://github.com/junegunn/fzf.git ~/.fzf
~/.fzf/install

# rust
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
source ~/.cargo/env
rustup completions bash cargo
source $(rustc --print sysroot)/etc/bash_completion.d/cargo

# 现代 ls
cargo install exa bat git-delta czkawka_cli drill fcp fd-find du-dust fnm
mkdir -p ~/.local/share/bash-completion/completions
curl -L https://raw.githubusercontent.com/ogham/exa/master/completions/bash/exa > ~/.local/share/bash-completion/completions/exa

# 命令行基准测试
cargo install hyperfine

# 更新所有 cargo 包
cargo install $(cargo install --list | egrep '^[a-z0-9_-]+ v[0-9.]+:$' | cut -f1 -d' ')

# github
sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-key C99B11DEB97541F0
sudo apt-add-repository https://cli.github.com/packages
up ; sudo apt install gh

# node https://nodejs.org/en/download/
version=16.13.1
fnm install v$version
npm install npm -g

# go https://go.dev/dl/
version=1.17.5
wget https://go.dev/dl/go$version.linux-amd64.tar.gz
sudo tar zxf go$version.linux-amd64.tar.gz -C /usr/
rm -rf go$version.linux-amd64.tar.gz
